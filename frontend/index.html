<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Juego cl√°sico de Tic Tac Toe con gesti√≥n de perfiles y estad√≠sticas">
    <title>Tic Tac Toe - Juego Profesional</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header" role="banner">
        <h1>üéÆ Tic Tac Toe</h1>
        <p>Juego cl√°sico con gesti√≥n de perfiles</p>
    </header>

    <!-- Theme Toggle -->
    <button id="themeToggle" class="btn btn-secondary" onclick="toggleTheme()" aria-label="Cambiar modo de color">
        üåô Modo Oscuro
    </button>

    <main class="container" role="main">
        <!-- Profile Section -->
        <section class="profile-section" aria-labelledby="profile-heading">
            <h2 id="profile-heading" class="sr-only">Gesti√≥n de Perfil</h2>
            <button class="btn btn-primary" onclick="openProfileModal()" aria-haspopup="dialog">
                üë§ Gestionar Perfil
            </button>
            <span id="current-profile" class="profile-status profile-inactive" aria-live="polite">
                Sin perfil activo
            </span>
        </section>

        <!-- Register Section -->
        <section id="register" aria-labelledby="config-heading">
            <div class="card">
                <h2 id="config-heading" class="card-title">‚öôÔ∏è Configuraci√≥n del Juego</h2>
                
                <form id="game-config" onsubmit="event.preventDefault(); start();">
                    <div class="form-group">
                        <div class="form-row">
                            <div>
                                <label for="p1">Jugador 1 (X)</label>
                                <input type="text" id="p1" placeholder="Nombre jugador 1" required>
                            </div>
                            <div>
                                <label for="p2">Jugador 2 (O)</label>
                                <input type="text" id="p2" placeholder="Nombre jugador 2" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="form-row">
                            <div>
                                <label for="colorX">üé® Color Jugador 1</label>
                                <input type="color" id="colorX" value="#e94560" aria-describedby="colorX-desc">
                                <span id="colorX-desc" class="sr-only">Selecciona el color para el jugador 1</span>
                            </div>
                            <div>
                                <label for="colorO">üé® Color Jugador 2</label>
                                <input type="color" id="colorO" value="#2ed573" aria-describedby="colorO-desc">
                                <span id="colorO-desc" class="sr-only">Selecciona el color para el jugador 2</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="form-row">
                            <div>
                                <label for="symbolX">‚úèÔ∏è S√≠mbolo Jugador 1</label>
                                <input type="text" id="symbolX" placeholder="X" maxlength="3" required>
                            </div>
                            <div>
                                <label for="symbolO">‚úèÔ∏è S√≠mbolo Jugador 2</label>
                                <input type="text" id="symbolO" placeholder="O" maxlength="3" required>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                        üöÄ Comenzar Juego
                    </button>
                </form>
            </div>
        </section>

        <!-- Game Section -->
        <section id="game" aria-labelledby="game-heading" hidden>
            <h2 id="game-heading" class="sr-only">Juego en curso</h2>
            <div class="game-layout">
                <!-- Main Game Area -->
                <div class="game-main">
                    <div class="turn-indicator" id="turn" aria-live="polite">
                        Turno: Jugador 1 (X)
                    </div>
                    
                    <div id="board" role="grid" aria-label="Tablero de juego"></div>
                    
                    <p id="status" aria-live="assertive"></p>
                    <p id="timer" aria-live="polite">‚è±Ô∏è Tiempo: 0s</p>

                    <button id="btnUndo" class="btn" onclick="undoMove()" disabled aria-label="Deshacer movimiento">
                        ‚¨ÖÔ∏è Deshacer
                    </button>

                    <div class="game-controls">
                        <button class="btn btn-secondary" onclick="restart()">
                            üîÑ Reiniciar Partida
                        </button>
                        <button class="btn btn-secondary" onclick="confirmAction('reset')">
                            üìä Reiniciar Marcador
                        </button>
                        <button class="btn btn-secondary" onclick="confirmAction('new')">
                            üÜï Nuevo Juego
                        </button>
                        <button class="btn btn-secondary" id="btnNames" onclick="openNameModal()">
                            ‚úèÔ∏è Cambiar Nombres
                        </button>
                        <button class="btn btn-secondary" onclick="openStats()">
                            üìà Ver Estad√≠sticas
                        </button>
                    </div>
                </div>

                <!-- Sidebar -->
                <aside class="sidebar" aria-labelledby="sidebar-heading">
                    <h3 id="sidebar-heading" class="sr-only">Informaci√≥n del juego</h3>
                    
                    <!-- Scoreboard -->
                    <div class="card scoreboard">
                        <h3 class="card-title">üèÜ Marcador</h3>
                        <div class="score-display">
                            <div class="score-item">
                                <div class="name" id="n1">J1</div>
                                <div class="value" id="s1">0</div>
                            </div>
                            <div class="score-item">
                                <div class="name">Empates</div>
                                <div class="value" id="draws">0</div>
                            </div>
                            <div class="score-item">
                                <div class="name" id="n2">J2</div>
                                <div class="value" id="s2">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- History -->
                    <div class="card">
                        <h3 class="card-title">üìú Historial</h3>
                        <div class="table-container">
                            <table id="history">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Resultado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Las filas se agregar√°n din√°micamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </aside>
            </div>
        </section>
    </main>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal" role="dialog" aria-labelledby="profile-modal-title" aria-hidden="true">
        <div class="modal-content">
            <button class="close" onclick="closeProfileModal()" aria-label="Cerrar modal">√ó</button>
            <h3 id="profile-modal-title">üë§ Gesti√≥n de Perfil</h3>
            
            <div id="profileLogin">
                <div class="form-group">
                    <label for="loginName">Nombre de perfil</label>
                    <input type="text" id="loginName" placeholder="Ingresa tu nombre de perfil" required>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="loginProfile()">
                    Iniciar Sesi√≥n
                </button>
                <p style="text-align: center; margin-top: 15px; color: #8892b0;">
                    ¬øNo tienes perfil? 
                    <button type="button" class="link" onclick="showCreateForm()">Crear uno nuevo</button>
                </p>
            </div>
            
            <div id="profileCreate" hidden>
                <div class="form-group">
                    <label for="createNombre">Nombre real</label>
                    <input type="text" id="createNombre" placeholder="Tu nombre completo" required>
                </div>
                <div class="form-group">
                    <label for="createPerfil">Nombre de perfil</label>
                    <input type="text" id="createPerfil" placeholder="Tu nombre de usuario" required>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="createProfile()">
                    Crear Perfil
                </button>
                <p style="text-align: center; margin-top: 15px; color: #8892b0;">
                    ¬øYa tienes perfil? 
                    <button type="button" class="link" onclick="showLoginForm()">Iniciar sesi√≥n</button>
                </p>
            </div>
            
            <div id="profileInfo" hidden>
                <div class="profile-info-item">
                    <span class="profile-info-label">Nombre:</span>
                    <span class="profile-info-value" id="profileDisplayName"></span>
                </div>
                <div class="profile-info-item">
                    <span class="profile-info-label">Perfil:</span>
                    <span class="profile-info-value" id="profileDisplayPerfil"></span>
                </div>
                <div class="profile-info-item">
                    <span class="profile-info-label">Estad√≠sticas:</span>
                    <span class="profile-info-value" id="profileStats">V: 0 | E: 0 | D: 0</span>
                </div>
                
                <div class="profile-actions">
                    <button class="btn btn-secondary" onclick="listAllProfiles()">
                        üìã Ver Todos los Perfiles
                    </button>
                    <button class="btn btn-danger" onclick="deleteCurrentProfile()">
                        üóëÔ∏è Eliminar Perfil
                    </button>
                    <button class="btn btn-secondary" onclick="logoutProfile()">
                        üö™ Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
            
            <p id="profileError" class="error-message" aria-live="assertive"></p>
        </div>
    </div>

    <!-- First Turn Modal -->
    <div id="firstTurnModal" class="modal" role="dialog" aria-labelledby="first-turn-title" aria-hidden="true">
        <div class="modal-content">
            <h3 id="first-turn-title">üéØ ¬øQui√©n inicia?</h3>
            <p style="text-align: center; color: #8892b0; margin-bottom: 20px;">
                Selecciona qui√©n har√° el primer movimiento
            </p>
            <div class="turn-options">
                <button class="btn btn-primary" onclick="setFirstTurn('X')">
                    ‚ùå X
                </button>
                <button class="btn btn-primary" onclick="setFirstTurn('O')">
                    ‚≠ï O
                </button>
                <button class="btn btn-secondary" onclick="setFirstTurn('R')">
                    üé≤ Aleatorio
                </button>
            </div>
        </div>
    </div>

    <!-- Generic Modal -->
    <div id="modal" class="modal" role="dialog" aria-labelledby="modal-msg" aria-hidden="true">
        <div class="modal-content">
            <button class="close" onclick="closeModal()" aria-label="Cerrar modal">√ó</button>
            <p id="modal-msg" style="text-align: center; font-size: 1.1rem;"></p>
            <div id="modal-buttons" style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Name Modal -->
    <div id="nameModal" class="modal" role="dialog" aria-labelledby="name-modal-title" aria-hidden="true">
        <div class="modal-content">
            <button class="close" onclick="closeNameModal()" aria-label="Cerrar modal">√ó</button>
            <h3 id="name-modal-title">‚úèÔ∏è Cambiar Nombres</h3>
            <div class="form-group">
                <label for="nameX">Jugador 1 (X)</label>
                <input type="text" id="nameX" required>
            </div>
            <div class="form-group">
                <label for="nameO">Jugador 2 (O)</label>
                <input type="text" id="nameO" required>
            </div>
            <p id="nameError" class="error-message" aria-live="assertive"></p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" style="flex: 1;" onclick="saveNames()">
                    Guardar
                </button>
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeNameModal()">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div id="statsModal" class="modal" role="dialog" aria-labelledby="stats-modal-title" aria-hidden="true">
        <div class="modal-content">
            <button class="close" onclick="closeStats()" aria-label="Cerrar modal">√ó</button>
            <h3 id="stats-modal-title">üìä Estad√≠sticas de Jugadores</h3>
            <div class="stats-item" id="statsX"></div>
            <div class="stats-item" id="statsO"></div>
            <div class="stats-item" id="statsDraws"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <p>Tic Tac Toe - Universidad Continental - Construcci√≥n de Software</p>
    </footer>

    <script src="scripts/config.js"></script>
    <script src="scripts/modal.js"></script>
    <script src="scripts/validation.js"></script>
    <script src="scripts/timer.js"></script>
    <script src="scripts/history.js"></script>
    <script src="scripts/utils.js"></script>
    <script src="scripts/profile.js"></script>
    <script src="scripts/game.js"></script>
    <script src="scripts/init.js"></script>
</body>
</html>